<nav class="navbar navbar-expand-lg navbar-dark bg-primary" [class.header--expanded]="isSearchExpanded" [class.header--collapsed]="!isSearchExpanded">
  <div class="container">
    <!-- Top Row: Logo, Search, Contact, Profile, Menu - All in One Line -->
    <div class="navbar-top-row">
      <!-- Logo -->
      <a class="navbar-brand fw-bold d-flex align-items-center" routerLink="/" [attr.aria-label]="'Home'">
        <div class="logo-container">
          <img src="/new-logo.png" alt="Travel Booking Logo" class="logo-image">
        </div>
      </a>

      <!-- Advanced Search (Center) - Hidden on Mobile -->
      <div class="navbar-search-center d-none d-md-block">
        <app-advanced-search (search)="onSearch($event)" (expanded)="onSearchExpanded($event)"></app-advanced-search>
      </div>

      <!-- Right Section: Contact, Profile, Menu -->
      <div class="header-right-section">
        <!-- Contact Button - Hidden on Mobile -->
        <a href="tel:+919929443313" class="btn-contact d-none d-md-flex">
          <i class="bi bi-telephone-fill"></i>
          <span class="contact-number">+91 9929443313</span>
        </a>
        
        <!-- Profile Icon (when logged in) or Sign In (when not logged in) -->
        <div class="profile-section">
          <!-- Sign In Button (when not logged in) -->
          <button
            *ngIf="!(isLoggedIn$ | async)"
            class="btn btn-outline-light btn-signin"
            (click)="openLoginModal()"
            aria-label="Login / Signup">
            <span class="d-none d-md-inline me-1">Login / Signup</span>
            <i class="bi bi-person"></i>
          </button>
          <!-- Profile Dropdown (when logged in) -->
          <app-profile-dropdown
            *ngIf="isLoggedIn$ | async"
            [user]="user$ | async">
          </app-profile-dropdown>
        </div>

        <!-- Mobile Menu Toggle Button -->
        <button 
          class="navbar-toggler d-md-none" 
          type="button" 
          (click)="toggleMobileMenu()"
          [attr.aria-expanded]="isMobileMenuOpen"
          aria-label="Toggle navigation menu"
          aria-controls="navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>

    <!-- Bottom Row: Navigation Menu -->
    <div class="navbar-bottom-row d-none d-md-flex">
      <div 
        class="collapse navbar-collapse" 
        id="navbarNav"
        [class.show]="isMobileMenuOpen">
        <!-- Mobile Menu Header -->
        <div class="mobile-menu-header d-md-none">
          <h5 class="mobile-menu-title">Menu</h5>
          <button 
            class="mobile-menu-close"
            (click)="closeMobileMenu()"
            aria-label="Close menu"
            type="button">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <!-- Mobile Search Section -->
        <div class="mobile-search-section d-md-none">
          <app-advanced-search (search)="onSearch($event); closeMobileMenu()"></app-advanced-search>
        </div>

        <ul class="navbar-nav">
          <li class="nav-item" [class.dropdown]="navItem.hasDropdown" *ngFor="let navItem of navigationItems">
            <!-- Wrapper div for dropdown hover area -->
            <div 
              class="dropdown-wrapper"
              *ngIf="navItem.hasDropdown"
              (mouseenter)="showDropdown(navItem.id)"
              (mouseleave)="hideDropdown(navItem.id)">
              <a
                class="nav-link"
                [class.dropdown-toggle]="navItem.hasDropdown"
                [class.active]="activeDropdown === navItem.id"
                [routerLink]="navItem.hasDropdown ? '#' : navItem.route"
                [routerLinkActive]="navItem.hasDropdown ? '' : 'active'"
                [attr.aria-expanded]="navItem.hasDropdown ? (activeDropdown === navItem.id ? 'true' : 'false') : null"
                [attr.aria-haspopup]="navItem.hasDropdown ? 'true' : null"
                [attr.id]="navItem.hasDropdown ? navItem.id + 'Dropdown' : null"
                [attr.aria-label]="navItem.label + (navItem.hasDropdown ? ' menu' : '')"
                (click)="navItem.hasDropdown ? $event.preventDefault() : closeMobileMenu()"
                (keydown.enter)="navItem.hasDropdown ? showDropdown(navItem.id) : null"
                (keydown.escape)="navItem.hasDropdown ? hideDropdown(navItem.id) : null"
                tabindex="0">
                <i class="bi" [ngClass]="getNavIcon(navItem.id)" *ngIf="getNavIcon(navItem.id)" aria-hidden="true"></i>
                {{ navItem.label }}
                <i class="bi bi-chevron-down ms-1" *ngIf="navItem.hasDropdown" style="font-size: 0.75rem;"></i>
              </a>
              <ul 
                class="dropdown-menu" 
                *ngIf="navItem.hasDropdown" 
                [attr.aria-labelledby]="navItem.id + 'Dropdown'"
                [class.show]="activeDropdown === navItem.id">
                <li *ngFor="let subItem of navItem.subItems">
                  <a class="dropdown-item" [routerLink]="subItem.route" [queryParams]="subItem.queryParams" (click)="hideDropdown(navItem.id); closeMobileMenu()">
                    <i class="bi" [ngClass]="subItem.icon" *ngIf="subItem.icon" aria-hidden="true"></i>
                    <span>{{ subItem.label }}</span>
                  </a>
                </li>
              </ul>
            </div>
            <!-- Non-dropdown items without wrapper -->
            <a
              *ngIf="!navItem.hasDropdown"
              class="nav-link"
              [routerLink]="navItem.route"
              [queryParams]="navItem.queryParams"
              [routerLinkActive]="'active'"
              (click)="closeMobileMenu()"
              tabindex="0">
              {{ navItem.label }}
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <app-login-modal
    *ngIf="showLoginModal"
    (close)="closeLoginModal()"
    (loginSuccess)="onLoginSuccess()">
  </app-login-modal>
</nav>
