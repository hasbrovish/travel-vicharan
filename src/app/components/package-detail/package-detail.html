<div class="container my-5" *ngIf="package">
  <!-- Package Header -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <h1 class="display-5 mb-3">{{ package.name }}</h1>
      <div class="d-flex align-items-center mb-3">
        <div class="text-warning me-3">
          <i class="bi bi-star-fill" *ngFor="let star of getStarArray(package.rating)"></i>
          <i class="bi bi-star-half" *ngIf="package.rating % 1 !== 0"></i>
          <span class="text-dark ms-2">{{ package.rating }}</span>
        </div>
        <span class="text-muted">({{ package.totalReviews }} reviews)</span>
      </div>
      <p class="lead">{{ package.description }}</p>
    </div>
  </div>

  <!-- Image Gallery -->
  <div class="row mb-4">
    <div class="col-12">
      <div id="packageCarousel" class="carousel slide" data-bs-ride="carousel">
        <!-- Indicators -->
        <div class="carousel-indicators">
          <button *ngFor="let image of package.galleryImages; let i = index"
                  type="button"
                  [attr.data-bs-target]="'#packageCarousel'"
                  [attr.data-bs-slide-to]="i"
                  [class.active]="i === 0"
                  [attr.aria-current]="i === 0 ? 'true' : null"
                  [attr.aria-label]="'Slide ' + (i + 1)"></button>
        </div>

        <!-- Slides -->
        <div class="carousel-inner">
          <div class="carousel-item" *ngFor="let image of package.galleryImages; let i = index" [class.active]="i === 0">
            <img [src]="image" class="d-block w-100" [alt]="package.name" style="height: 400px; object-fit: cover;">
          </div>
        </div>

        <!-- Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#packageCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#packageCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Left Column - Details -->
    <div class="col-lg-8">
      <!-- Tabs -->
      <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
            Overview
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab === 'itinerary'" (click)="setActiveTab('itinerary')">
            Itinerary
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab === 'inclusions'" (click)="setActiveTab('inclusions')">
            Inclusions & Exclusions
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Overview Tab -->
        <div *ngIf="activeTab === 'overview'">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Package Highlights</h5>
              <ul class="list-unstyled">
                <li *ngFor="let highlight of package.highlights" class="mb-2">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>{{ highlight }}
                </li>
              </ul>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Destinations</h5>
              <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-primary" *ngFor="let dest of package.destinations">
                  <i class="bi bi-geo-alt-fill me-1"></i>{{ dest }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Itinerary Tab -->
        <div *ngIf="activeTab === 'itinerary'">
          <div class="accordion" id="itineraryAccordion">
            <div class="accordion-item" *ngFor="let day of package.itinerary">
              <h2 class="accordion-header" [id]="'heading' + day.day">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        [attr.data-bs-target]="'#collapse' + day.day">
                  Day {{ day.day }}: {{ day.title }}
                </button>
              </h2>
              <div [id]="'collapse' + day.day" class="accordion-collapse collapse"
                   [attr.data-bs-parent]="'#itineraryAccordion'">
                <div class="accordion-body">
                  <p>{{ day.description }}</p>
                  <h6 class="mt-3">Activities:</h6>
                  <ul>
                    <li *ngFor="let activity of day.activities">{{ activity }}</li>
                  </ul>
                  <div class="mt-2">
                    <strong>Meals: </strong>
                    <span class="badge bg-secondary me-1" *ngFor="let meal of day.meals">{{ meal }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Inclusions & Exclusions Tab -->
        <div *ngIf="activeTab === 'inclusions'">
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0">Inclusions</h5>
                </div>
                <div class="card-body">
                  <ul class="list-unstyled">
                    <li *ngFor="let item of package.inclusions" class="mb-2">
                      <i class="bi bi-check-circle-fill text-success me-2"></i>{{ item }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-danger text-white">
                  <h5 class="mb-0">Exclusions</h5>
                </div>
                <div class="card-body">
                  <ul class="list-unstyled">
                    <li *ngFor="let item of package.exclusions" class="mb-2">
                      <i class="bi bi-x-circle-fill text-danger me-2"></i>{{ item }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Booking Card -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 100px;">
        <div class="card-body">
          <h5 class="card-title">Book This Package</h5>
          <hr>

          <div class="mb-3">
            <label class="form-label">Duration</label>
            <div>
              <span class="badge bg-info">{{ package.days }} Days / {{ package.nights }} Nights</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Select Departure</label>
            <select class="form-select" [(ngModel)]="selectedDeparture">
              <option *ngFor="let dep of package.departures" [ngValue]="dep">
                {{ dep.date | date }} - {{ dep.departureCity }} ({{ dep.availableSeats }} seats)
              </option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Number of Passengers</label>
            <input type="number" class="form-control" [(ngModel)]="numberOfPassengers" min="1" max="10">
          </div>

          <hr>

          <div class="mb-3">
            <div class="d-flex justify-content-between">
              <span>Base Price (per person):</span>
              <strong>{{ package.currency }} {{ package.basePrice | number }}</strong>
            </div>
            <div class="d-flex justify-content-between mt-2">
              <span>Number of Passengers:</span>
              <strong>{{ numberOfPassengers }}</strong>
            </div>
          </div>

          <div class="bg-light p-3 rounded mb-3">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Total Amount:</h5>
              <h4 class="mb-0 text-primary">{{ package.currency }} {{ totalAmount | number }}</h4>
            </div>
          </div>

          <button class="btn btn-primary w-100 btn-lg" (click)="proceedToBooking()"
                  [disabled]="!selectedDeparture || selectedDeparture.status === 'SOLD_OUT'">
            <i class="bi bi-calendar-check me-2"></i>Book Now
          </button>

          <div class="alert alert-warning mt-3" *ngIf="selectedDeparture?.status === 'FILLING_FAST'">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>Filling Fast! Book Soon
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="text-center py-5" *ngIf="loading">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
