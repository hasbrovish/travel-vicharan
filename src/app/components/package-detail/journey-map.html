<!-- Journey Map Component Template -->
<div class="journey-map-wrapper">
  <!-- SVG Path - Continuous vertical journey line with semantic doodles -->
  <svg class="journey-path-svg" viewBox="0 0 1200 2000" preserveAspectRatio="xMidYMid meet">
    <!-- Main continuous journey path (behind everything) -->
    <path class="journey-path"
          [attr.d]="getJourneyPath(package.itinerary.length)"
          fill="none"
          stroke="#f97316"
          stroke-width="3"
          stroke-dasharray="10,5"
          stroke-linecap="round"
          opacity="0.5"/>

    <!-- Semantic Doodles Layer - Made MUCH more visible -->
    <g class="journey-doodles">
      <!-- Airplane with dotted trail near Day 1 (journey start) -->
      <!-- Position: near start of path (5% of 2000 = 100, so y=80 is just before) -->
      <g class="doodle-airplane" transform="translate(700, 80)">
        <!-- Airplane body - larger and bolder -->
        <path d="M 0,-12 L 5,-7 L 5,7 L 0,12 L -5,7 L -5,-7 Z"
              fill="#f97316" fill-opacity="0.3" stroke="#f97316" stroke-width="2.5" stroke-linejoin="round"/>
        <!-- Wings -->
        <path d="M -12,0 L 12,0 M -5,-5 L -5,5"
              stroke="#f97316" stroke-width="2.5" stroke-linecap="round"/>
        <!-- Dotted trail - longer and more visible -->
        <path d="M -18,0 L -35,3 L -52,1 L -70,4 L -88,2"
              stroke="#f97316" stroke-width="2" stroke-dasharray="4,5"
              stroke-linecap="round" opacity="0.8"/>
      </g>

      <!-- Stars between days - MUCH larger and more visible -->
      <!-- Star 1: Between Day 1 and Day 2 (around 25% = 500) -->
      <g class="doodle-star" transform="translate(480, 450)">
        <path d="M 0,-10 L 2.5,-2.5 L 10,0 L 2.5,2.5 L 0,10 L -2.5,2.5 L -10,0 L -2.5,-2.5 Z"
              fill="#f97316" fill-opacity="0.2" stroke="#f97316" stroke-width="2.5" opacity="0.85"/>
      </g>

      <!-- Star 2: Between Day 2 and Day 3 (around 50% = 1000) -->
      <g class="doodle-star" transform="translate(720, 900)">
        <path d="M 0,-8 L 2,-2 L 8,0 L 2,2 L 0,8 L -2,2 L -8,0 L -2,-2 Z"
              fill="#f97316" fill-opacity="0.2" stroke="#f97316" stroke-width="2.5" opacity="0.85"/>
      </g>

      <!-- Star 3: Between Day 3 and Day 4 (around 65% = 1300) -->
      <g class="doodle-star" transform="translate(500, 1350)">
        <path d="M 0,-10 L 2.5,-2.5 L 10,0 L 2.5,2.5 L 0,10 L -2.5,2.5 L -10,0 L -2.5,-2.5 Z"
              fill="#f97316" fill-opacity="0.2" stroke="#f97316" stroke-width="2.5" opacity="0.85"/>
      </g>

      <!-- Destination marker near last day (around 85% = 1700) -->
      <g class="doodle-destination" transform="translate(710, 1750)">
        <circle cx="0" cy="0" r="8" fill="none" stroke="#f97316" stroke-width="2.5" opacity="0.8"/>
        <circle cx="0" cy="0" r="4" fill="#f97316" opacity="0.6"/>
      </g>
    </g>
  </svg>

  <!-- Day Stops - Alternating left/right -->
  <div class="journey-days-container">
    <div class="journey-day-stop"
         *ngFor="let day of package.itinerary; let i = index"
         [class.left]="i % 2 === 0"
         [class.right]="i % 2 === 1"
         [class.expanded]="expandedDay === day.day"
         [style.top.%]="getDayPosition(i, package.itinerary.length)">
      
      <!-- Map Pin -->
      <div class="map-pin-stop">
        <div class="pin-circle-stop">
          <span class="pin-number">{{ day.day }}</span>
        </div>
      </div>

      <!-- Day Card (Collapsed) -->
      <div class="day-card-minimal" 
           [class.expanded]="expandedDay === day.day"
           (click)="toggleDay(day.day)">
        <div class="day-card-header">
          <div class="day-number-badge">{{ day.day }}</div>
          <div class="day-card-content">
            <h3 class="day-card-title">{{ day.title }}</h3>
            <div class="day-highlights">
              <span class="highlight-line" *ngFor="let highlight of getDayHighlights(day); let idx = index">
                {{ highlight }}
              </span>
            </div>
            <div class="day-duration">
              <i class="bi bi-clock"></i>
              <span>{{ getDayDuration(day) }}</span>
            </div>
          </div>
        </div>
        <button class="view-plan-btn" *ngIf="expandedDay !== day.day">
          <span>View full day plan</span>
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>

      <!-- Day Detail Panel (Expanded) -->
      <div class="day-detail-panel" 
           *ngIf="expandedDay === day.day"
           [@slideDown]>
        <div class="detail-panel-header">
          <h4 class="detail-panel-title">Day {{ day.day }}: {{ day.title }}</h4>
          <button class="close-detail-btn" (click)="closeDay()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <div class="detail-panel-content">
          <!-- Journey Overview -->
          <div class="journey-overview" *ngIf="day.description">
            <p class="overview-text">{{ day.description }}</p>
          </div>

          <!-- Operational Details: Morning / Afternoon / Evening -->
          <div class="operational-schedule" *ngIf="day.timePeriods && day.timePeriods.length > 0">
            <div class="time-period-detail" *ngFor="let period of day.timePeriods">
              <div class="period-header-detail">
                <div class="period-icon-detail" 
                     [class.morning]="period.period === 'Morning'"
                     [class.afternoon]="period.period === 'Afternoon'"
                     [class.evening]="period.period === 'Evening'">
                  <i class="bi" 
                     [class.bi-sunrise]="period.period === 'Morning'"
                     [class.bi-sun]="period.period === 'Afternoon'"
                     [class.bi-moon-stars]="period.period === 'Evening'"></i>
                </div>
                <div class="period-title-detail">
                  <h5>{{ period.period }}</h5>
                  <span class="travel-time-badge" *ngIf="period.travelTime">
                    <i class="bi bi-clock"></i> {{ period.travelTime }}
                  </span>
                </div>
              </div>

              <div class="period-details">
                <!-- Activities with timings -->
                <div class="detail-section" *ngIf="period.activities && period.activities.length > 0">
                  <h6 class="detail-section-title">Activities</h6>
                  <ul class="detail-list">
                    <li *ngFor="let activity of period.activities">{{ activity }}</li>
                  </ul>
                </div>

                <!-- Meals -->
                <div class="detail-section" *ngIf="period.meals && period.meals.length > 0">
                  <h6 class="detail-section-title">Meals Included</h6>
                  <div class="meals-list">
                    <span class="meal-tag" *ngFor="let meal of period.meals">{{ meal }}</span>
                  </div>
                </div>

                <!-- Inclusions -->
                <div class="detail-section" *ngIf="period.inclusions && period.inclusions.length > 0">
                  <h6 class="detail-section-title">Included</h6>
                  <ul class="inclusions-list">
                    <li *ngFor="let inclusion of period.inclusions">
                      <i class="bi bi-check-circle"></i>
                      <span>{{ inclusion }}</span>
                    </li>
                  </ul>
                </div>

                <!-- Notes -->
                <div class="detail-section" *ngIf="period.notes">
                  <h6 class="detail-section-title">Important Notes</h6>
                  <p class="notes-text">{{ period.notes }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Travel & Logistics -->
          <div class="travel-logistics" *ngIf="day.transport || day.distance || day.duration || day.accommodation">
            <h5 class="logistics-title">Travel & Logistics</h5>
            <div class="logistics-grid">
              <div class="logistics-item" *ngIf="day.transport">
                <i class="bi bi-car-front"></i>
                <div>
                  <strong>Vehicle Type</strong>
                  <p>{{ day.transport }}</p>
                </div>
              </div>
              <div class="logistics-item" *ngIf="day.distance">
                <i class="bi bi-signpost-split"></i>
                <div>
                  <strong>Distance</strong>
                  <p>{{ day.distance }}</p>
                </div>
              </div>
              <div class="logistics-item" *ngIf="day.duration">
                <i class="bi bi-clock-history"></i>
                <div>
                  <strong>Travel Time</strong>
                  <p>{{ day.duration }}</p>
                </div>
              </div>
              <div class="logistics-item" *ngIf="day.accommodation">
                <i class="bi bi-building"></i>
                <div>
                  <strong>Accommodation</strong>
                  <p>{{ day.accommodation }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Optional Activities -->
          <div class="optional-activities" *ngIf="day.optionalActivities && day.optionalActivities.length > 0">
            <h5 class="optional-title">Optional / Extra Cost</h5>
            <ul class="optional-list">
              <li *ngFor="let optional of day.optionalActivities">
                <i class="bi bi-plus-circle"></i>
                <span>{{ optional }}</span>
              </li>
            </ul>
          </div>

          <!-- Important Notes -->
          <div class="important-notes-section" *ngIf="day.importantNotes && day.importantNotes.length > 0">
            <h5 class="important-title">
              <i class="bi bi-exclamation-triangle"></i>
              Important Notes
            </h5>
            <ul class="important-notes-list">
              <li *ngFor="let note of day.importantNotes">{{ note }}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
