<div class="advanced-search-container" [class.search-active]="isFocused || showSuggestions">
  <div class="search-wrapper">
    <div class="search-input-group" #searchInputGroup>
      <span class="search-shortcut">Q</span>
      <i class="bi bi-search search-icon"></i>
      <input
        type="text"
        class="search-input"
        [(ngModel)]="searchQuery"
        (input)="onInputChange()"
        (focus)="onFocus()"
        (blur)="onBlur()"
        (keydown)="onKeyDown($event)"
        [placeholder]="currentPlaceholder"
        aria-label="Search destinations, packages, and experiences"
        aria-autocomplete="list"
        aria-expanded="{{showSuggestions && isFocused}}"
        role="combobox"
        autocomplete="off">
      <button
        *ngIf="searchQuery"
        class="search-clear"
        (click)="clearSearch()"
        type="button"
        aria-label="Clear search">
        <i class="bi bi-x-lg"></i>
      </button>
      <button
        class="search-voice"
        type="button"
        title="Voice Search"
        aria-label="Voice Search"
        (click)="onVoiceSearch()">
        <i class="bi bi-mic" aria-hidden="true"></i>
      </button>
      <button
        class="search-button"
        type="button"
        title="Search"
        aria-label="Search"
        (click)="performSearch()"
        [disabled]="!searchQuery || searchQuery.trim().length === 0">
        <i class="bi bi-search" aria-hidden="true"></i>
        <span class="search-button-text">Search</span>
      </button>
    </div>

    <!-- Journey Discovery Dropdown - Premium Redesign -->
    <div
      #searchSuggestions
      class="journey-discovery-dropdown"
      [class.visible]="showSuggestions && isFocused"
      *ngIf="showSuggestions && isFocused"
      role="listbox"
      aria-label="Journey discovery panel">

      <!-- Search Results (when typing) -->
      <div class="search-results-section" *ngIf="suggestions.length > 0 && searchQuery.trim().length > 0">
        <div
          class="result-item"
          *ngFor="let suggestion of suggestions; let i = index"
          (mousedown)="isClickingSuggestion = true"
          (click)="selectSuggestion(suggestion, $event)"
          (keydown.enter)="selectSuggestion(suggestion, $event)"
          role="option"
          [attr.aria-label]="suggestion.label + (suggestion.count ? ' - ' + suggestion.count + ' tours' : '')"
          [attr.tabindex]="i === 0 ? '0' : '-1'">
          <div class="result-icon">
            <i class="bi" [ngClass]="{
              'bi-geo-alt-fill': suggestion.type === 'destination',
              'bi-box-seam': suggestion.type === 'package',
              'bi-star-fill': suggestion.type === 'popular',
              'bi-tags': suggestion.type === 'category',
              'bi-building': suggestion.type === 'departure-city'
            }"></i>
          </div>
          <div class="result-content">
            <span class="result-label" [innerHTML]="highlightMatch(suggestion.label)"></span>
            <span class="result-type">{{ getTypeLabel(suggestion.type) }}</span>
          </div>
          <span class="result-count" *ngIf="suggestion.count">
            <span class="count-number">{{ suggestion.count }}</span>
            <span class="count-label">tours</span>
          </span>
          <i class="bi bi-arrow-right-short result-arrow"></i>
        </div>
      </div>

      <!-- Journey Discovery Content (empty search state) -->
      <div class="journey-content" *ngIf="suggestions.length === 0 || searchQuery.trim().length === 0">

        <!-- Inspirational Helper Text -->
        <div class="search-helper-text">
          Start with a place, we'll handle the rest.
        </div>

        <!-- Section 1: Recent Searches (compact, max 2) -->
        <div class="discovery-section recent-section" *ngIf="recentSearches.length > 0">
          <div class="section-header">
            <div class="section-header-left">
              <i class="bi bi-clock-history section-icon"></i>
              <h3 class="section-title">Recent</h3>
            </div>
            <button
              class="clear-recent-btn"
              type="button"
              (click)="clearRecentSearches()"
              aria-label="Clear recent searches">
              Clear
            </button>
          </div>
          <div class="recent-list">
            <button
              *ngFor="let recent of recentSearches.slice(0, 2)"
              class="recent-item"
              type="button"
              (mousedown)="isClickingSuggestion = true"
              (click)="selectSuggestion(recent, $event)">
              <i class="bi bi-clock-history"></i>
              <span>{{ recent.label }}</span>
            </button>
          </div>
        </div>

        <!-- Section 2: Popular Destinations (chips with icons) -->
        <div class="discovery-section destinations-section">
          <div class="section-header">
            <div class="section-header-left">
              <i class="bi bi-compass section-icon"></i>
              <h3 class="section-title">Popular Destinations</h3>
            </div>
          </div>
          <div class="destination-chips">
            <button
              *ngFor="let chip of quickChips"
              class="destination-chip"
              type="button"
              (mousedown)="isClickingSuggestion = true"
              (click)="selectSuggestion(chip, $event)">
              <i class="bi" [ngClass]="getDestinationIcon(chip.label)"></i>
              <span>{{ chip.label }}</span>
            </button>
          </div>
        </div>

        <!-- Section 3: Quick Inspiration Categories -->
        <div class="discovery-section inspiration-section">
          <div class="section-header">
            <i class="bi bi-lightbulb section-icon"></i>
            <h3 class="section-title">Trip Inspiration</h3>
          </div>
          <div class="inspiration-grid">
            <button
              *ngFor="let category of inspirationCategories"
              class="inspiration-card"
              type="button"
              (mousedown)="isClickingSuggestion = true"
              (click)="selectInspiration(category)">
              <div class="card-icon">
                <i class="bi" [ngClass]="category.icon"></i>
              </div>
              <div class="card-content">
                <span class="card-title">{{ category.label }}</span>
                <span class="card-count">{{ category.count }} trips</span>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- Section 4: Primary CTA Button -->
      <div class="discovery-footer">
        <button
          class="explore-all-btn"
          type="button"
          (click)="exploreAllTrips()"
          (mousedown)="isClickingSuggestion = true">
          <span>Explore all {{ tripCount }} trips</span>
          <i class="bi bi-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
