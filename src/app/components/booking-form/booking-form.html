<div class="container my-5" *ngIf="package">
  <div class="row">
    <div class="col-lg-8">
      <h2 class="mb-4">Complete Your Booking</h2>

      <!-- Package Summary -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
              <img [src]="package.imageUrl" [alt]="package.name" class="img-fluid rounded">
            </div>
            <div class="col-md-9">
              <h4>{{ package.name }}</h4>
              <p class="text-muted">{{ package.days }} Days / {{ package.nights }} Nights</p>
              <p><strong>Departure:</strong> {{ departureDate | date:'fullDate' }}</p>
              <p><strong>Passengers:</strong> {{ numberOfPassengers }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Passenger Details Form -->
      <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
        <div formArrayName="passengers">
          <div *ngFor="let passenger of passengers.controls; let i = index" class="card mb-3">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Passenger {{ i + 1 }} Details</h5>
              <button type="button" class="btn btn-sm btn-outline-light" (click)="removePassenger(i)"
                      *ngIf="passengers.length > 1">
                <i class="bi bi-trash"></i>
              </button>
            </div>
            <div class="card-body" [formGroupName]="i">
              <div class="row">
                <div class="col-md-2 mb-3">
                  <label class="form-label">Title *</label>
                  <select class="form-select" formControlName="title">
                    <option *ngFor="let title of titles" [value]="title">{{ title }}</option>
                  </select>
                </div>
                <div class="col-md-5 mb-3">
                  <label class="form-label">First Name *</label>
                  <input type="text" class="form-control" formControlName="firstName" placeholder="Enter first name">
                  <div class="text-danger small" *ngIf="passenger.get('firstName')?.invalid && passenger.get('firstName')?.touched">
                    First name is required
                  </div>
                </div>
                <div class="col-md-5 mb-3">
                  <label class="form-label">Last Name *</label>
                  <input type="text" class="form-control" formControlName="lastName" placeholder="Enter last name">
                  <div class="text-danger small" *ngIf="passenger.get('lastName')?.invalid && passenger.get('lastName')?.touched">
                    Last name is required
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Age *</label>
                  <input type="number" class="form-control" formControlName="age" placeholder="Age">
                  <div class="text-danger small" *ngIf="passenger.get('age')?.invalid && passenger.get('age')?.touched">
                    Valid age required
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Gender *</label>
                  <select class="form-select" formControlName="gender">
                    <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Email *</label>
                  <input type="email" class="form-control" formControlName="email" placeholder="email@example.com">
                  <div class="text-danger small" *ngIf="passenger.get('email')?.invalid && passenger.get('email')?.touched">
                    Valid email required
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Phone *</label>
                  <input type="tel" class="form-control" formControlName="phone" placeholder="10-digit mobile number">
                  <div class="text-danger small" *ngIf="passenger.get('phone')?.invalid && passenger.get('phone')?.touched">
                    Valid 10-digit phone required
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-grid gap-2 mt-4">
          <button type="submit" class="btn btn-primary btn-lg" [disabled]="submitting || bookingForm.invalid">
            <span *ngIf="!submitting">
              <i class="bi bi-check-circle me-2"></i>Confirm Booking
            </span>
            <span *ngIf="submitting">
              <span class="spinner-border spinner-border-sm me-2"></span>Processing...
            </span>
          </button>
        </div>
      </form>
    </div>

    <!-- Booking Summary Sidebar -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 100px;">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Booking Summary</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Package:</span>
              <strong>{{ package.name }}</strong>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Duration:</span>
              <strong>{{ package.days }}D/{{ package.nights }}N</strong>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Departure:</span>
              <strong>{{ departureDate | date:'shortDate' }}</strong>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Passengers:</span>
              <strong>{{ numberOfPassengers }}</strong>
            </div>
          </div>

          <hr>

          <div class="mb-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Price per person:</span>
              <strong>₹{{ package.basePrice | number }}</strong>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Total passengers:</span>
              <strong>{{ numberOfPassengers }}</strong>
            </div>
          </div>

          <div class="bg-light p-3 rounded">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Total Amount:</h5>
              <h4 class="mb-0 text-primary">₹{{ totalAmount | number }}</h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
